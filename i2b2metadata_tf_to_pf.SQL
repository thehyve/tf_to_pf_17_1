--------------------------------------------------------------------------
-- Play this script in I2B2METADATA@EC2-54-93-196-236.EU-CENTRAL-1.COMPUTE.AMAZONAWS.COM:1522/ORCL to make it look like I2B2METADATA@EC2-54-93-196-236.EU-CENTRAL-1.COMPUTE.AMAZONAWS.COM:1523/ORCL
--
-- Please review the script before using it to make sure it won't
-- cause any unacceptable data loss.
--
-- I2B2METADATA@EC2-54-93-196-236.EU-CENTRAL-1.COMPUTE.AMAZONAWS.COM:1522/ORCL Schema Extracted by User SYSTEM 
-- I2B2METADATA@EC2-54-93-196-236.EU-CENTRAL-1.COMPUTE.AMAZONAWS.COM:1523/ORCL Schema Extracted by User SYSTEM 



-- no table I2B2METADATA.dimension_description
-- move it to 17.1 script
CREATE SEQUENCE I2B2METADATA.DIMENSION_DESCRIPTION_ID_SEQ
  START WITH 1
  MAXVALUE 9999999999999999999999999999
  MINVALUE 1
  NOCYCLE
  CACHE 20
  NOORDER;

CREATE OR REPLACE EDITIONABLE TRIGGER "I2B2METADATA"."DIMENSION_DESCRIPTION_ID_TRG"
BEFORE INSERT ON I2B2METADATA.dimension_description
FOR EACH ROW
BEGIN
  if inserting then
    if :NEW."ID" is null then
      SELECT DIMENSION_DESCRIPTION_ID_SEQ.NEXTVAL
      INTO   :new.id
      FROM   dual;
    end if;
  end if;
END;
/
ALTER TRIGGER "I2B2METADATA"."DIMENSION_DESCRIPTION_ID_TRG" ENABLE;



-- we have default 0 by request
-- double check
ALTER TABLE I2B2METADATA.I2B2_TAG_TYPES
MODIFY("index"  NULL);

ALTER TABLE I2B2METADATA.I2B2_TAG_TYPES
MODIFY("index"  DEFAULT NULL);


-- we have, but also ck not null
-- double check
ALTER TABLE I2B2METADATA.I2B2
MODIFY(UPDATE_DATE  DEFAULT NULL);



-- add
ALTER TABLE I2B2METADATA.I2B2_TAGS
MODIFY(PATH  NOT NULL);

ALTER TABLE I2B2METADATA.I2B2_TAGS
MODIFY(TAG_TYPE  NOT NULL);



CREATE UNIQUE INDEX I2B2METADATA.I2B2_TAGS_PATH_TAG_TYPE_KEY ON I2B2METADATA.I2B2_TAGS
(PATH, TAG_TYPE);

ALTER TABLE I2B2METADATA.I2B2_TAGS
 ADD CONSTRAINT I2B2_TAGS_PATH_TAG_TYPE_KEY
  UNIQUE (PATH, TAG_TYPE)
  USING INDEX I2B2METADATA.I2B2_TAGS_PATH_TAG_TYPE_KEY;
